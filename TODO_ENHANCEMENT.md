# GSCT 全フェーズ・エンハンス TODOリスト

本リストは `ENHANCE_PLAN_JP.md` に基づき、実装タスクを細分化したものです。

---

## Phase 1: Foundation & Reliability（基盤と信頼性）
- [x] **1.1 コード分割と仮想モジュール化 (リファクタリング)**
    - [x] `const state = { ... }` への状態変数の一元集約。
    - [x] `// --- MODULE: [NAME] ---` コメントによるデータ、ロジック、UI、描画の境界設定。
    - [x] `UIManager`, `NauticalEngine`, `EconomyEngine` への機能カプセル化。
    - [x] UI生成をテンプレートリテラルを用いる `render` 関数群へ移行。
- [x] **1.2 航路の適正化 (Nautical Routing)**
    - [x] `MARITIME_WAYPOINTS`（運河、海峡、岬、沿岸ポイント）の定義と座標設定。
    - [x] 拠点ごとの「海岸線上の入港ポイント」設定による陸地突っ込みの防止。
    - [x] 大円（直線）を避け、ウェイポイントを経由する動的パス生成ロジックの実装。
    - [x] **特定重要航路の最適化（検証済み）**:
        - [x] ブラジル-中国: 大西洋を横断し喜望峰（Cape）へ直行するルート。
        - [x] ブラジル-インド: 北東へ直進しジブラルタル（Gibraltar）からスエズへ向かうルート。
        - [x] インド-USA: カナリア諸島・カリブ海・キューバを経由する南寄り大西洋横断ルート。
        - [x] ベトナム着: 台湾・韓国方面へ行き過ぎず、マラッカ通過後直接入港するルート。
- [x] **1.3 共通イベント・フレームワークの構築**
    - [x] スパイク（需要増）とクライシス（停滞）を統合した `EventSystem` の構築。
    - [x] イベント発生時、ノードや航路のパラメータをリアルタイムで操作する仕組み。
    - [x] 通知エリアとパーティクル演出を、イベントタイプ（ポジティブ/ネガティブ）で色分け統合。
- [x] **1.4 ゲームフローと進行管理**
    - [x] ゲーム開始前のプレイ期間（1/3/5年）選択UIの実装。
    - [x] 年次終了（365日）ごとの成績表示モーダルと一時停止処理。
    - [x] 画面上部への「Year X / Y」進捗表示の追加。

## Phase 2: Visibility & Analytics（可視化と分析）
- [x] **2.1 詳細財務分析 (Cost-to-Serve)**
    - [x] 製品1個あたりの「製造・輸送・保管・廃棄」コストを内訳表示。
    - [x] 累積利益ではなく、期間ごとの収益効率を可視化するUI。
- [x] **2.2 感度分析グラフ (What-if分析)**
    - [x] 輸送頻度や輸送モードの変更が、将来の在庫とコストに与える影響のグラフ表示（Net Flow / Margin Trend）。
    - [x] 適正在庫（安全在庫）ラインの表示と欠品リスクの視覚化。

## Phase 3: Strategic Growth（投資と拡大）
- [x] **3.1 拠点別・選択的投資システム (Specialized Investment)**
    - [x] 拠点アップグレードを「一律強化」から「三系統の選択制」へ変更：
        - 1. **自動化投資**: 加工費・原材料コストの削減。
        - 2. **品質管理投資**: 輸送中・保管中の品質劣化スピードを抑制。
        - 3. **設備拡張投資**: 生産・処理能力および最大在庫量の拡大。
    - [x] **ROI（投資回収予測）のUI表示**: 
        - 投資額に対し「現在のスループットに基づき何日で元が取れるか」の推定値をパネルに表示。
- [x] **3.2 戦略的拠点開放 (Strategic Hub Unlocking)**
    - [x] 未開放の「候補地（ロック状態のノード）」をマップ上にグレーアウト表示。
    - [x] 建設費用を支払い、定義済みの産地・工場・市場をネットワークに追加する機能。
    - [x] 候補地のデータ定義（オーストラリア、メキシコ、イギリスなど）。
- [x] **3.3 ネットワークの手動構築 (Route Commissioning)**
    - [x] 新規拠点建設後、既存拠点との間に「航路開通投資」を必要とする仕様。
    - [x] 拠点間の接続可否と開通コストの定義。
    - [x] 未開通航路の点線表示と、投資によるアクティベーション。

## Phase 4: Operational Complexity（製造の複雑性）
- [x] **4.1 BOM（部品構成表）システムの導入**
    - [x] 複数の部材（Raw Material X, Part Y）から完成品を作るアセンブリロジック。
    - [x] 工場での部材の「揃い待ち（Synchronization）」による停滞リスクの導入。
- [x] **4.2 リードタイムの積み上げと同期管理**
    - [x] 部材ごとの異なる調達リードタイムを考慮した発注計画の難易度アップ。
    - [x] 1つの部品欠品によるライン停止の警告と損失表示。

## Phase 5: Sustainability & Brand（GXとサステナビリティ）
- [ ] **5.1 カーボンフットプリントの可視化**
    - [ ] 輸送モード（空路 vs 海路）に応じたCO2排出量の算出ロジック。
    - [ ] 総排出量に対する炭素税や環境規制によるペナルティの実装。
- [ ] **5.2 グリーン投資 (Green Transformation)**
    - [ ] 電気貨物船、再生可能エネルギー工場へのアップグレード。
    - [ ] グリーン投資による長期的な税負担軽減とブランド価値（需要増）の反映。
- [ ] **5.3 ESG経営スコア**
    - [ ] 利益、欠品率、環境負荷の3軸で評価される最終成績評価システム。
